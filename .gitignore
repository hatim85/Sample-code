/target
Cargo.lock


## Endpoint: /authorizer/is_authorized (Success Case)
param_hex: "4a56bd549630925b07004a320ece3d57c02b72214bce79988cdf0ac57b1ab55ba5e11c86fd829d7d7b88bb064d4d7dc1b6cae8861522fab7d7216117ce45bc32c635286b82727b322b7a5e16d13255ce4aa63f6b3e2a04ef7fdbe5f5367df8080000000000000000"
package_hex: "a1014a56bd549630925b07004a320ece3d57c02b72214bce79988cdf0ac57b1ab55ba5e11c86fd829d7d7b88bb064d4d7dc1b6cae8861522fab7d7216117ce45bc32c635286b82727b322b7a5e16d13255ce4aa63f6b3e2a04ef7fdbe5f5367df8080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004010000000000000000000000000000000000000000000000000000000000000000000000846d792074657374207061796c6f616420666f7220617574686f72697a6174696f6e40420f000000000020a107000000000000000000"
core_index_hex: "0100"

## Endpoint: /service/refine
service_id_hex: "01000000"
payload_hex: "2c48656c6c6f2c204a414d21"
package_hash_hex: "0101010101010101010101010101010101010101010101010101010101010101"
context_hex: "00"
auth_code_hash_hex: "0202020202020202020202020202020202020202020202020202020202020202"

## Endpoint: /service/accumulate
slot_hex: "01000000"
service_id_hex: "01000000"
items_hex: "04000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a1014a56bd549630925b07004a320ece3d57c02b72214bce79988cdf0ac57b1ab55ba5e11c86fd829d7d7b88bb064d4d7dc1b6cae8861522fab7d7216117ce45bc32c635286b82727b322b7a5e16d13255ce4aa63f6b3e2a04ef7fdbe5f5367df80800000000000000004c42a9048aab5bcb71e1b7aa798333aac55cd1118538a63115fdf0b3e046e10d002c776f726b206f7574707574"

## Endpoint: /service/on_transfer
slot_hex: "01000000"
service_id_hex: "01000000"
transfers_hex: "047b00000001000000e803000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040420f0000000000"



Excellent! The script ran successfully, and you now have all the valid test data you need. ðŸ¥³

Now, let's use that data to test your running API. Make sure your server is running in one terminal window (RUST_LOG=info cargo run), and you'll run the following curl commands in a separate terminal window.

You will need to copy the hex strings from your output and paste them into the commands below where it says <PASTE ... HERE>.

1. Test the Authorizer (Success Case)
This command sends a validly signed package to the authorizer. Since it's the first time this user (public key) is seen, the nonce of 0 is correct.

Bash

curl --location 'http://127.0.0.1:8080/authorizer/is_authorized' \
--header 'Content-Type: application/json' \
--data '{
    "param_hex": "4a56bd549630925b07004a320ece3d57c02b72214bce79988cdf0ac57b1ab55ba5e11c86fd829d7d7b88bb064d4d7dc1b6cae8861522fab7d7216117ce45bc32c635286b82727b322b7a5e16d13255ce4aa63f6b3e2a04ef7fdbe5f5367df8080000000000000000",
    "package_hex": "a1014a56bd549630925b07004a320ece3d57c02b72214bce79988cdf0ac57b1ab55ba5e11c86fd829d7d7b88bb064d4d7dc1b6cae8861522fab7d7216117ce45bc32c635286b82727b322b7a5e16d13255ce4aa63f6b3e2a04ef7fdbe5f5367df8080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004010000000000000000000000000000000000000000000000000000000000000000000000846d792074657374207061796c6f616420666f7220617574686f72697a6174696f6e40420f000000000020a107000000000000000000",
    "core_index_hex": "0100"
}'
Expected Output: A JSON response where the output_hex value is the exact same as the param_hex you sent. This indicates successful authorization.

Check Server Logs: You should see Authorization successful. in your server's terminal.

2. Test the Accumulate Function
This simulates the step after a successful authorization, where the service's state is updated. Critically, this will increment the user's nonce from 0 to 1.

Bash

curl --location 'http://127.0.0.1:8080/service/accumulate' \
--header 'Content-Type: application/json' \
--data '{
    "slot_hex": "01000000",
    "service_id_hex": "01000000",
    "items_hex": "04000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a1014a56bd549630925b07004a320ece3d57c02b72214bce79988cdf0ac57b1ab55ba5e11c86fd829d7d7b88bb064d4d7dc1b6cae8861522fab7d7216117ce45bc32c635286b82727b322b7a5e16d13255ce4aa63f6b3e2a04ef7fdbe5f5367df80800000000000000004c42a9048aab5bcb71e1b7aa798333aac55cd1118538a63115fdf0b3e046e10d002c776f726b206f7574707574"
}'
Expected Output: {"hash_hex":null}

Check Server Logs: You should see a log message like Nonce for pk ... incremented to 1.

3. Test the Authorizer Again (Replay Attack Failure)
Now, re-run the exact same command from Step 1. This time it should fail because the service now expects a nonce of 1, but the request is still sending 0. This proves your replay protection is working.

Expected Output: A JSON response where output_hex is a hash that represents the "INVALID_NONCE" error.

Check Server Logs: You should see Auth failed: Invalid nonce. Expected 1, got 0.

4. Test the Refine Function
This tests the core stateless logic of your service.

Bash

curl --location 'http://127.0.0.1:8080/service/refine' \
--header 'Content-Type: application/json' \
--data '{
    "service_id_hex": "01000000",
    "payload_hex": "2c48656c6c6f2c204a414d21",
    "package_hash_hex": "0101010101010101010101010101010101010101010101010101010101010101",
    "context_hex": "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    "auth_code_hash_hex": "0202020202020202020202020202020202020202020202020202020202020202"
}'
Expected Output: A JSON response with a work_output_hex field. If you decode this hex, it will be the bytes for "Refined: Hello, JAM!".

5. Test the on_transfer Function
This tests the stateful logic for handling transfers.

Bash

curl --location 'http://127.0.0.1:8080/service/on_transfer' \
--header 'Content-Type: application/json' \
--data '{
    "slot_hex": "01000000",
    "service_id_hex": "01000000",
    "transfers_hex": "047b00000001000000e803000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040420f0000000000"
}'
Expected Output: {"status":"ok"}

Check Server Logs: You should see messages indicating that a command was decoded and that the new state was written with an updated counter.

